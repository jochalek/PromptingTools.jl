<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>F.A.Q. · PromptingTools.jl</title><meta name="title" content="F.A.Q. · PromptingTools.jl"/><meta property="og:title" content="F.A.Q. · PromptingTools.jl"/><meta property="twitter:title" content="F.A.Q. · PromptingTools.jl"/><meta name="description" content="Documentation for PromptingTools.jl."/><meta property="og:description" content="Documentation for PromptingTools.jl."/><meta property="twitter:description" content="Documentation for PromptingTools.jl."/><meta property="og:url" content="https://svilupp.github.io/PromptingTools.jl/frequently_asked_questions/"/><meta property="twitter:url" content="https://svilupp.github.io/PromptingTools.jl/frequently_asked_questions/"/><link rel="canonical" href="https://svilupp.github.io/PromptingTools.jl/frequently_asked_questions/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">PromptingTools.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../getting_started/">Getting Started</a></li><li><a class="tocitem" href="../how_it_works/">How It Works</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../examples/readme_examples/">Various examples</a></li><li><a class="tocitem" href="../examples/working_with_aitemplates/">Using AITemplates</a></li><li><a class="tocitem" href="../examples/working_with_ollama/">Local models with Ollama.ai</a></li><li><a class="tocitem" href="../examples/working_with_google_ai_studio/">Google AIStudio</a></li><li><a class="tocitem" href="../examples/working_with_custom_apis/">Custom APIs (Mistral, Llama.cpp)</a></li><li><a class="tocitem" href="../examples/building_RAG/">Building RAG Application</a></li></ul></li><li class="is-active"><a class="tocitem" href>F.A.Q.</a><ul class="internal"><li><a class="tocitem" href="#Why-OpenAI"><span>Why OpenAI</span></a></li><li><a class="tocitem" href="#Data-Privacy-and-OpenAI"><span>Data Privacy and OpenAI</span></a></li><li><a class="tocitem" href="#Creating-OpenAI-API-Key"><span>Creating OpenAI API Key</span></a></li><li><a class="tocitem" href="#Getting-an-error-&quot;ArgumentError:-api*key-cannot-be-empty&quot;-despite-having-set-OPENAI*API_KEY?"><span>Getting an error &quot;ArgumentError: api<em>key cannot be empty&quot; despite having set `OPENAI</em>API_KEY`?</span></a></li><li><a class="tocitem" href="#Setting-OpenAI-Spending-Limits"><span>Setting OpenAI Spending Limits</span></a></li><li><a class="tocitem" href="#Configuring-the-Environment-Variable-for-API-Key"><span>Configuring the Environment Variable for API Key</span></a></li><li><a class="tocitem" href="#Setting-the-API-Key-via-Preferences.jl"><span>Setting the API Key via Preferences.jl</span></a></li><li><a class="tocitem" href="#Understanding-the-API-Keyword-Arguments-in-aigenerate-(api_kwargs)"><span>Understanding the API Keyword Arguments in <code>aigenerate</code> (<code>api_kwargs</code>)</span></a></li><li><a class="tocitem" href="#Instant-Access-from-Anywhere"><span>Instant Access from Anywhere</span></a></li><li><a class="tocitem" href="#Open-Source-Alternatives"><span>Open Source Alternatives</span></a></li><li><a class="tocitem" href="#Setup-Guide-for-Ollama"><span>Setup Guide for Ollama</span></a></li><li><a class="tocitem" href="#Changing-the-Default-Model-or-Schema"><span>Changing the Default Model or Schema</span></a></li><li><a class="tocitem" href="#How-to-have-Multi-turn-Conversations?"><span>How to have Multi-turn Conversations?</span></a></li><li><a class="tocitem" href="#How-to-have-typed-responses?"><span>How to have typed responses?</span></a></li><li><a class="tocitem" href="#How-to-quickly-create-a-prompt-template?"><span>How to quickly create a prompt template?</span></a></li></ul></li><li><span class="tocitem">Reference</span><ul><li><a class="tocitem" href="../reference/">PromptingTools.jl</a></li><li><a class="tocitem" href="../reference_experimental/">Experimental Modules</a></li><li><a class="tocitem" href="../reference_ragtools/">RAGTools</a></li><li><a class="tocitem" href="../reference_agenttools/">AgentTools</a></li><li><a class="tocitem" href="../reference_apitools/">APITools</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>F.A.Q.</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>F.A.Q.</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/svilupp/PromptingTools.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/svilupp/PromptingTools.jl/blob/main/docs/src/frequently_asked_questions.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Frequently-Asked-Questions"><a class="docs-heading-anchor" href="#Frequently-Asked-Questions">Frequently Asked Questions</a><a id="Frequently-Asked-Questions-1"></a><a class="docs-heading-anchor-permalink" href="#Frequently-Asked-Questions" title="Permalink"></a></h1><h2 id="Why-OpenAI"><a class="docs-heading-anchor" href="#Why-OpenAI">Why OpenAI</a><a id="Why-OpenAI-1"></a><a class="docs-heading-anchor-permalink" href="#Why-OpenAI" title="Permalink"></a></h2><p>OpenAI&#39;s models are at the forefront of AI research and provide robust, state-of-the-art capabilities for many tasks.</p><p>There will be situations not or cannot use it (eg, privacy, cost, etc.). In that case, you can use local models (eg, Ollama) or other APIs (eg, Anthropic).</p><p>Note: To get started with <a href="https://ollama.ai/">Ollama.ai</a>, see the <a href="#setup-guide-for-ollama">Setup Guide for Ollama</a> section below.</p><h2 id="Data-Privacy-and-OpenAI"><a class="docs-heading-anchor" href="#Data-Privacy-and-OpenAI">Data Privacy and OpenAI</a><a id="Data-Privacy-and-OpenAI-1"></a><a class="docs-heading-anchor-permalink" href="#Data-Privacy-and-OpenAI" title="Permalink"></a></h2><p>At the time of writing, OpenAI does NOT use the API calls for training their models.</p><blockquote><p><strong>API</strong></p><p>OpenAI does not use data submitted to and generated by our API to train OpenAI models or improve OpenAI’s service offering. In order to support the continuous improvement of our models, you can fill out this form to opt-in to share your data with us. – <a href="https://help.openai.com/en/articles/5722486-how-your-data-is-used-to-improve-model-performance">How your data is used to improve our models</a></p></blockquote><p>You can always double-check the latest information on the <a href="https://platform.openai.com/docs/models/how-we-use-your-data">OpenAI&#39;s How we use your data</a> page.</p><p>Resources:</p><ul><li><a href="https://platform.openai.com/docs/models/how-we-use-your-data">OpenAI&#39;s How we use your data</a></li><li><a href="https://help.openai.com/en/articles/7039943-data-usage-for-consumer-services-faq">Data usage for consumer services FAQ</a></li><li><a href="https://help.openai.com/en/articles/5722486-how-your-data-is-used-to-improve-model-performance">How your data is used to improve our models</a></li></ul><h2 id="Creating-OpenAI-API-Key"><a class="docs-heading-anchor" href="#Creating-OpenAI-API-Key">Creating OpenAI API Key</a><a id="Creating-OpenAI-API-Key-1"></a><a class="docs-heading-anchor-permalink" href="#Creating-OpenAI-API-Key" title="Permalink"></a></h2><p>You can get your API key from OpenAI by signing up for an account and accessing the API section of the OpenAI website.</p><ol><li>Create an account with <a href="https://platform.openai.com/signup">OpenAI</a></li><li>Go to <a href="https://platform.openai.com/account/api-keys">API Key page</a></li><li>Click on “Create new secret key”</li></ol><p>!!! Do not share it with anyone and do NOT save it to any files that get synced online.</p><p>Resources:</p><ul><li><a href="https://platform.openai.com/docs/quickstart?context=python">OpenAI Documentation</a></li><li><a href="https://www.maisieai.com/help/how-to-get-an-openai-api-key-for-chatgpt">Visual tutorial</a></li></ul><p>Pro tip: Always set the spending limits!</p><h2 id="Getting-an-error-&quot;ArgumentError:-api*key-cannot-be-empty&quot;-despite-having-set-OPENAI*API_KEY?"><a class="docs-heading-anchor" href="#Getting-an-error-&quot;ArgumentError:-api*key-cannot-be-empty&quot;-despite-having-set-OPENAI*API_KEY?">Getting an error &quot;ArgumentError: api<em>key cannot be empty&quot; despite having set `OPENAI</em>API_KEY`?</a><a id="Getting-an-error-&quot;ArgumentError:-api*key-cannot-be-empty&quot;-despite-having-set-OPENAI*API_KEY?-1"></a><a class="docs-heading-anchor-permalink" href="#Getting-an-error-&quot;ArgumentError:-api*key-cannot-be-empty&quot;-despite-having-set-OPENAI*API_KEY?" title="Permalink"></a></h2><p>Quick fix: just provide kwarg <code>api_key</code> with your key to the <code>aigenerate</code> function (and other <code>ai*</code> functions).</p><p>This error is thrown when the OpenAI API key is not available in 1) local preferences or 2) environment variables (<code>ENV[&quot;OPENAI_API_KEY&quot;]</code>).</p><p>First, check if you can access the key by running <code>ENV[&quot;OPENAI_API_KEY&quot;]</code> in the Julia REPL. If it returns <code>nothing</code>, the key is not set.</p><p>If the key is set, but you still get the error, there was a rare bug in earlier versions where if you first precompiled PromptingTools without the API key, it would remember it and &quot;compile away&quot; the <code>get(ENV,...)</code> function call. If you&#39;re experiencing this bug on the latest version of PromptingTools, please open an issue on GitHub.</p><p>The solution is to force a new precompilation, so you can do any of the below:</p><ol><li>Force precompilation (run <code>Pkg.precompile()</code> in the Julia REPL)</li><li>Update the PromptingTools package (runs precompilation automatically)</li><li>Delete your compiled cache in <code>.julia</code> DEPOT (usually <code>.julia/compiled/v1.10/PromptingTools</code>). You can do it manually in the file explorer or via Julia REPL: <code>rm(&quot;~/.julia/compiled/v1.10/PromptingTools&quot;, recursive=true, force=true)</code></li></ol><h2 id="Setting-OpenAI-Spending-Limits"><a class="docs-heading-anchor" href="#Setting-OpenAI-Spending-Limits">Setting OpenAI Spending Limits</a><a id="Setting-OpenAI-Spending-Limits-1"></a><a class="docs-heading-anchor-permalink" href="#Setting-OpenAI-Spending-Limits" title="Permalink"></a></h2><p>OpenAI allows you to set spending limits directly on your account dashboard to prevent unexpected costs.</p><ol><li>Go to <a href="https://platform.openai.com/account/billing">OpenAI Billing</a></li><li>Set Soft Limit (you’ll receive a notification) and Hard Limit (API will stop working not to spend more money)</li></ol><p>A good start might be a soft limit of c.<span>$5 and a hard limit of c.$</span>10 - you can always increase it later in the month.</p><p>Resources:</p><ul><li><a href="https://community.openai.com/t/how-to-set-a-price-limit/13086">OpenAI Forum</a></li></ul><h3 id="How-much-does-it-cost?-Is-it-worth-paying-for?"><a class="docs-heading-anchor" href="#How-much-does-it-cost?-Is-it-worth-paying-for?">How much does it cost? Is it worth paying for?</a><a id="How-much-does-it-cost?-Is-it-worth-paying-for?-1"></a><a class="docs-heading-anchor-permalink" href="#How-much-does-it-cost?-Is-it-worth-paying-for?" title="Permalink"></a></h3><p>If you use a local model (eg, with Ollama), it&#39;s free. If you use any commercial APIs (eg, OpenAI), you will likely pay per &quot;token&quot; (a sub-word unit).</p><p>For example, a simple request with a simple question and 1 sentence response in return (”Is statement XYZ a positive comment”) will cost you ~0.0001 (ie, one-hundredth of a cent)</p><p><strong>Is it worth paying for?</strong></p><p>GenAI is a way to buy time! You can pay cents to save tens of minutes every day.</p><p>Continuing the example above, imagine you have a table with 200 comments. Now, you can parse each one of them with an LLM for the features/checks you need.  Assuming the price per call was 0.0001, you&#39;d pay 2 cents for the job and save 30-60 minutes of your time!</p><p>Resources:</p><ul><li><a href="https://openai.com/pricing">OpenAI Pricing per 1000 tokens</a></li></ul><h2 id="Configuring-the-Environment-Variable-for-API-Key"><a class="docs-heading-anchor" href="#Configuring-the-Environment-Variable-for-API-Key">Configuring the Environment Variable for API Key</a><a id="Configuring-the-Environment-Variable-for-API-Key-1"></a><a class="docs-heading-anchor-permalink" href="#Configuring-the-Environment-Variable-for-API-Key" title="Permalink"></a></h2><p>This is a guide for OpenAI&#39;s API key, but it works for any other API key you might need (eg, <code>MISTRALAI_API_KEY</code> for MistralAI API).</p><p>To use the OpenAI API with PromptingTools.jl, set your API key as an environment variable:</p><pre><code class="language-julia hljs">ENV[&quot;OPENAI_API_KEY&quot;] = &quot;your-api-key&quot;</code></pre><p>As a one-off, you can: </p><ul><li>set it in the terminal before launching Julia: <code>export OPENAI_API_KEY = &lt;your key&gt;</code></li><li>set it in your <code>setup.jl</code> (make sure not to commit it to GitHub!)</li></ul><p>Make sure to start Julia from the same terminal window where you set the variable. Easy check in Julia, run <code>ENV[&quot;OPENAI_API_KEY&quot;]</code> and you should see your key!</p><p>A better way:</p><ul><li>On a Mac, add the configuration line to your terminal&#39;s configuration file (eg, <code>~/.zshrc</code>). It will get automatically loaded every time you launch the terminal</li><li>On Windows, set it as a system variable in &quot;Environment Variables&quot; settings (see the Resources)</li></ul><p>Resources: </p><ul><li><a href="https://platform.openai.com/docs/quickstart?context=python">OpenAI Guide</a></li></ul><h2 id="Setting-the-API-Key-via-Preferences.jl"><a class="docs-heading-anchor" href="#Setting-the-API-Key-via-Preferences.jl">Setting the API Key via Preferences.jl</a><a id="Setting-the-API-Key-via-Preferences.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Setting-the-API-Key-via-Preferences.jl" title="Permalink"></a></h2><p>You can also set the API key in <code>LocalPreferences.toml</code>, so it persists across sessions and projects.</p><p>Use: <code>PromptingTools.set_preferences!(&quot;OPENAI_API_KEY&quot;=&quot;your-api-key&quot;)</code></p><p>To double-check, run <code>PromptingTools.get_preferences(&quot;OPENAI_API_KEY&quot;)</code> and you should see your key!</p><p>See more detail in the <code>?PromptingTools.PREFERENCES</code> docstring.</p><h2 id="Understanding-the-API-Keyword-Arguments-in-aigenerate-(api_kwargs)"><a class="docs-heading-anchor" href="#Understanding-the-API-Keyword-Arguments-in-aigenerate-(api_kwargs)">Understanding the API Keyword Arguments in <code>aigenerate</code> (<code>api_kwargs</code>)</a><a id="Understanding-the-API-Keyword-Arguments-in-aigenerate-(api_kwargs)-1"></a><a class="docs-heading-anchor-permalink" href="#Understanding-the-API-Keyword-Arguments-in-aigenerate-(api_kwargs)" title="Permalink"></a></h2><p>See <a href="https://platform.openai.com/docs/guides/text-generation/chat-completions-api">OpenAI API reference</a> for more information.</p><h2 id="Instant-Access-from-Anywhere"><a class="docs-heading-anchor" href="#Instant-Access-from-Anywhere">Instant Access from Anywhere</a><a id="Instant-Access-from-Anywhere-1"></a><a class="docs-heading-anchor-permalink" href="#Instant-Access-from-Anywhere" title="Permalink"></a></h2><p>For easy access from anywhere, add PromptingTools into your <code>startup.jl</code> (can be found in <code>~/.julia/config/startup.jl</code>).</p><p>Add the following snippet:</p><pre><code class="nohighlight hljs">using PromptingTools
const PT = PromptingTools # to access unexported functions and types</code></pre><p>Now, you can just use <code>ai&quot;Help me do X to achieve Y&quot;</code> from any REPL session!</p><h2 id="Open-Source-Alternatives"><a class="docs-heading-anchor" href="#Open-Source-Alternatives">Open Source Alternatives</a><a id="Open-Source-Alternatives-1"></a><a class="docs-heading-anchor-permalink" href="#Open-Source-Alternatives" title="Permalink"></a></h2><p>The ethos of PromptingTools.jl is to allow you to use whatever model you want, which includes Open Source LLMs. The most popular and easiest to setup is <a href="https://ollama.ai/">Ollama.ai</a> - see below for more information.</p><h2 id="Setup-Guide-for-Ollama"><a class="docs-heading-anchor" href="#Setup-Guide-for-Ollama">Setup Guide for Ollama</a><a id="Setup-Guide-for-Ollama-1"></a><a class="docs-heading-anchor-permalink" href="#Setup-Guide-for-Ollama" title="Permalink"></a></h2><p>Ollama runs a background service hosting LLMs that you can access via a simple API. It&#39;s especially useful when you&#39;re working with some sensitive data that should not be sent anywhere.</p><p>Installation is very easy, just download the latest version <a href="https://ollama.ai/download">here</a>.</p><p>Once you&#39;ve installed it, just launch the app and you&#39;re ready to go!</p><p>To check if it&#39;s running, go to your browser and open <code>127.0.0.1:11434</code>. You should see the message &quot;Ollama is running&quot;.  Alternatively, you can run <code>ollama serve</code> in your terminal and you&#39;ll get a message that it&#39;s already running.</p><p>There are many models available in <a href="https://ollama.ai/library">Ollama Library</a>, including Llama2, CodeLlama, SQLCoder, or my personal favorite <code>openhermes2.5-mistral</code>.</p><p>Download new models with <code>ollama pull &lt;model_name&gt;</code> (eg, <code>ollama pull openhermes2.5-mistral</code>). </p><p>Show currently available models with <code>ollama list</code>.</p><p>See <a href="https://ollama.ai/">Ollama.ai</a> for more information.</p><h2 id="Changing-the-Default-Model-or-Schema"><a class="docs-heading-anchor" href="#Changing-the-Default-Model-or-Schema">Changing the Default Model or Schema</a><a id="Changing-the-Default-Model-or-Schema-1"></a><a class="docs-heading-anchor-permalink" href="#Changing-the-Default-Model-or-Schema" title="Permalink"></a></h2><p>If you tend to use non-default options, it can get tedious to specify <code>PT.*</code> every time.</p><p>There are three ways how you can customize your workflows (especially when you use Ollama or other local models):</p><ol><li>Import the functions/types you need explicitly at the top (eg, <code>using PromptingTools: OllamaSchema</code>)</li><li>Register your model and its associated schema  (<code>PT.register_model!(; name=&quot;123&quot;, schema=PT.OllamaSchema())</code>). You won&#39;t have to specify the schema anymore only the model name. See <a href="#working-with-ollama">Working with Ollama</a> for more information.</li><li>Override your default model (<code>PT.MODEL_CHAT</code>) and schema (<code>PT.PROMPT_SCHEMA</code>). It can be done persistently with Preferences, eg, <code>PT.set_preferences!(&quot;PROMPT_SCHEMA&quot; =&gt; &quot;OllamaSchema&quot;, &quot;MODEL_CHAT&quot;=&gt;&quot;llama2&quot;)</code>.</li></ol><h2 id="How-to-have-Multi-turn-Conversations?"><a class="docs-heading-anchor" href="#How-to-have-Multi-turn-Conversations?">How to have Multi-turn Conversations?</a><a id="How-to-have-Multi-turn-Conversations?-1"></a><a class="docs-heading-anchor-permalink" href="#How-to-have-Multi-turn-Conversations?" title="Permalink"></a></h2><p>Let&#39;s say you would like to respond back to a model&#39;s response. How to do it?</p><ol><li>With <code>ai&quot;&quot;</code> macro</li></ol><p>The simplest way if you used <code>ai&quot;&quot;</code> macro, is to send a reply with the <code>ai!&quot;&quot;</code> macro. It will use the last response as the conversation.</p><pre><code class="language-julia hljs">ai&quot;Hi! I&#39;m John&quot;

ai!&quot;What&#39;s my name?&quot;
# Return: &quot;Your name is John.&quot;</code></pre><ol><li>With <code>aigenerate</code> function</li></ol><p>You can use the <code>conversation</code> keyword argument to pass the previous conversation (in all <code>ai*</code> functions). It will prepend the past <code>conversation</code> before sending the new request to the model.</p><p>To get the conversation, set <code>return_all=true</code> and store the whole conversation thread (not just the last message) in a variable. Then, use it as a keyword argument in the next call.</p><pre><code class="language-julia hljs">conversation = aigenerate(&quot;Hi! I&#39;m John&quot;; return_all=true)
@info last(conversation) # display the response

# follow-up (notice that we provide past messages as conversation kwarg
conversation = aigenerate(&quot;What&#39;s my name?&quot;; return_all=true, conversation)

## [ Info: Tokens: 50 @ Cost: $0.0 in 1.0 seconds
## 5-element Vector{PromptingTools.AbstractMessage}:
##  PromptingTools.SystemMessage(&quot;Act as a helpful AI assistant&quot;)
##  PromptingTools.UserMessage(&quot;Hi! I&#39;m John&quot;)
##  AIMessage(&quot;Hello John! How can I assist you today?&quot;)
##  PromptingTools.UserMessage(&quot;What&#39;s my name?&quot;)
##  AIMessage(&quot;Your name is John.&quot;)</code></pre><p>Notice that the last message is the response to the second request, but with <code>return_all=true</code> we can see the whole conversation from the beginning.</p><h2 id="How-to-have-typed-responses?"><a class="docs-heading-anchor" href="#How-to-have-typed-responses?">How to have typed responses?</a><a id="How-to-have-typed-responses?-1"></a><a class="docs-heading-anchor-permalink" href="#How-to-have-typed-responses?" title="Permalink"></a></h2><p>Our responses are always in <code>AbstractMessage</code> types to ensure we can also handle downstream processing, error handling, and self-healing code (see <code>airetry!</code>).</p><p>A good use case for a typed response is when you have a complicated control flow and would like to group and handle certain outcomes differently. You can easily do it as an extra step after the response is received.</p><p>Trivially, we can use <code>aiclassifier</code> for Bool statements, eg, </p><pre><code class="language-julia hljs"># We can do either
mybool = tryparse(Bool, aiclassify(&quot;Is two plus two four?&quot;)) isa Bool # true

# or simply check equality
msg = aiclassify(&quot;Is two plus two four?&quot;) # true
mybool = msg.content == &quot;true&quot;</code></pre><p>Now a more complicated example with multiple categories mapping to an enum:</p><pre><code class="language-julia hljs">choices = [(&quot;A&quot;, &quot;any animal or creature&quot;), (&quot;P&quot;, &quot;for any plant or tree&quot;), (&quot;O&quot;, &quot;for everything else&quot;)]

# Set up the return types we want
@enum Categories A P O
string_to_category = Dict(&quot;A&quot; =&gt; A, &quot;P&quot; =&gt; P,&quot;O&quot; =&gt; O)

# Run an example
input = &quot;spider&quot;
msg = aiclassify(:InputClassifier; choices, input)

mytype = string_to_category[msg.content] # A (for animal)</code></pre><p>How does it work? <code>aiclassify</code> guarantees to output one of our choices (and it handles some of the common quirks)!</p><p>How would we achieve the same with <code>aigenerate</code> and arbitrary struct? We need to use the &quot;lazy&quot; <code>AIGenerate</code> struct and <code>airetry!</code> to ensure we get the response and then we can process it further.</p><p><code>AIGenerate</code> has two fields you should know about:</p><ul><li><code>conversation</code> - eg, the vector of &quot;messages&quot; in the current conversation (same as what you get from <code>aigenerate</code> with <code>return_all=true</code>)</li><li><code>success</code> - a boolean flag if the request was successful AND if it passed any subsequent <code>airetry!</code> calls</li></ul><p>Let&#39;s mimic a case where our &quot;program&quot; should return one of three types: <code>SmallInt</code>, <code>LargeInt</code>, <code>FailedResponse</code>.</p><p>We first need to define our custom types:</p><pre><code class="language-julia hljs">
# not needed, just to show a fully typed example
abstract type MyAbstractResponse end
struct SmallInt &lt;: MyAbstractResponse
    number::Int
end
struct LargeInt &lt;: MyAbstractResponse
    number::Int
end
struct FailedResponse &lt;: MyAbstractResponse
    content::String
end</code></pre><p>Let&#39;s define our &quot;program&quot; as a function to be cleaner. Notice that we use <code>AIGenerate</code> and <code>airetry!</code> to ensure we get the response and then we can process it further.</p><pre><code class="language-julia hljs">using PromptingTools.Experimental.AgentTools

function give_me_number(prompt::String)::MyAbstractResponse
    # Generate the response
    response = AIGenerate(prompt; config=RetryConfig(;max_retries=2)) |&gt; run!

    # Check if it&#39;s parseable as Int, if not, send back to be fixed
    # syntax: airetry!(CONDITION-TO-CHECK, &lt;response object&gt;, FEEDBACK-TO-MODEL)
    airetry!(x-&gt;tryparse(Int,last_output(x))|&gt;!isnothing, response, &quot;Wrong output format! Answer with digits and nothing else. The number is:&quot;)

    if response.success != true
        ## we failed to generate a parseable integer
        return FailedResponse(&quot;I failed to get the response. Last output: $(last_output(response))&quot;)
    end
    number = tryparse(Int,last_output(response))
    return number &lt; 1000 ? SmallInt(number) : LargeInt(number)
end

give_me_number(&quot;How many car seats are in Porsche 911T?&quot;)
## [ Info: Condition not met. Retrying...
## [ Info: Condition not met. Retrying...
## SmallInt(2)</code></pre><p>We ultimately received our custom type <code>SmallInt</code> with the number of car seats in the Porsche 911T (I hope it&#39;s correct!).</p><p>If you want to access the full conversation history (all the attempts and feedback), simply output the <code>response</code> object and explore <code>response.conversation</code>.</p><h2 id="How-to-quickly-create-a-prompt-template?"><a class="docs-heading-anchor" href="#How-to-quickly-create-a-prompt-template?">How to quickly create a prompt template?</a><a id="How-to-quickly-create-a-prompt-template?-1"></a><a class="docs-heading-anchor-permalink" href="#How-to-quickly-create-a-prompt-template?" title="Permalink"></a></h2><p>Many times, you will want to create a prompt template that you can reuse with different inputs (eg, to create templates for AIHelpMe or LLMTextAnalysis). </p><p>Previously, you would have to create a vector of <code>SystemMessage</code> and <code>UserMessage</code> objects and then save it to a disk and reload.  Now, you can use the <code>create_template</code> function to do it for you. It&#39;s designed for quick prototyping, so it skips the serialization step and loads it directly into the template store (ie, you can use it like any other templates - try <code>aitemplates()</code> search).</p><p>The syntax is simple: <code>create_template(;user=&lt;user prompt&gt;, system=&lt;system prompt&gt;, load_as=&lt;template name&gt;)</code> </p><p>When called it creates a vector of messages, which you can use directly in the <code>ai*</code> functions. If you provide <code>load_as</code>, it will load the template in the template store (under the <code>load_as</code> name).</p><p>Let&#39;s generate a quick template for a simple conversation (only one placeholder: name)</p><pre><code class="language-julia hljs"># first system message, then user message (or use kwargs)
tpl=PT.create_template(&quot;You must speak like a pirate&quot;, &quot;Say hi to {{name}}&quot;; load_as=&quot;GreatingPirate&quot;)

## 2-element Vector{PromptingTools.AbstractChatMessage}:
## PromptingTools.SystemMessage(&quot;You must speak like a pirate&quot;)
##  PromptingTools.UserMessage(&quot;Say hi to {{name}}&quot;)</code></pre><p>You can immediately use this template in <code>ai*</code> functions:</p><pre><code class="language-julia hljs">aigenerate(tpl; name=&quot;Jack Sparrow&quot;)
# Output: AIMessage(&quot;Arr, me hearty! Best be sending me regards to Captain Jack Sparrow on the salty seas! May his compass always point true to the nearest treasure trove. Yarrr!&quot;)</code></pre><p>Since we provided <code>load_as</code>, it&#39;s also registered in the template store:</p><pre><code class="language-julia hljs">aitemplates(&quot;pirate&quot;)

## 1-element Vector{AITemplateMetadata}:
## PromptingTools.AITemplateMetadata
##   name: Symbol GreatingPirate
##   description: String &quot;&quot;
##   version: String &quot;1.0&quot;
##   wordcount: Int64 46
##   variables: Array{Symbol}((1,))
##   system_preview: String &quot;You must speak like a pirate&quot;
##   user_preview: String &quot;Say hi to {{name}}&quot;
##   source: String &quot;&quot;</code></pre><p>So you can use it like any other template:</p><pre><code class="language-julia hljs">aigenerate(:GreatingPirate; name=&quot;Jack Sparrow&quot;)
# Output: AIMessage(&quot;Arr, me hearty! Best be sending me regards to Captain Jack Sparrow on the salty seas! May his compass always point true to the nearest treasure trove. Yarrr!&quot;)</code></pre><p>If you want to save it in your project folder:</p><pre><code class="language-julia hljs">PT.save_template(&quot;templates/GreatingPirate.json&quot;, tpl; version=&quot;1.0&quot;) # optionally, add description</code></pre><p>It will be saved and accessed under its basename, ie, <code>GreatingPirate</code> (same as <code>load_as</code> keyword argument).</p><p>Note: If you make any changes to the templates on the disk/in a folder, you need to explicitly reload all templates again!</p><p>If you are using the main PromptingTools templates, you can simply call <code>PT.load_templates!()</code>. If you have a project folder with your templates, you want to add it first:</p><pre><code class="language-julia hljs">PT.load_templates!(&quot;templates&quot;) </code></pre><p>After the first run, we will remember the folder and you can simply call <code>PT.load_templates!()</code> to reload all the templates in the future!</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../examples/building_RAG/">« Building RAG Application</a><a class="docs-footer-nextpage" href="../reference/">PromptingTools.jl »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Friday 1 March 2024 19:44">Friday 1 March 2024</span>. Using Julia version 1.10.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
